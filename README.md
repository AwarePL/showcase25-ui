# Project Overview: End-to-End Testing with Cypress

This project is a frontend application with a robust end-to-end (E2E) testing setup using [Cypress](https://www.cypress.io/). It supports running tests in multiple environments (development, staging, production) and provides flexibility to run tests in headless mode, parallel, or via the GUI. The project is structured to ensure maintainability, scalability, and integration with CI/CD pipelines.

---

## 📦 Project Structure

```
.
├── .github/                # GitHub Actions workflows
│   └── workflows/
│       └── cypress.yml     # CI/CD pipeline for running Cypress tests
├── cypress/                # Cypress test files and support
│   ├── e2e/                # E2E test files
│   │   └── test.cy.js      # Example test file
│   ├── support/            # Cypress support files
│   │   └── e2e.js          # Global Cypress configuration
│   └── commands.js         # Custom Cypress commands (imported by e2e.js)
├── config/                 # Cypress configuration files
│   └── base.config.js      # Base configuration for Cypress
├── cypress.env.js          # Environment-specific variables
├── cypressRunner.js        # Script to dynamically generate Cypress config
├── package.json            # Project dependencies and scripts
└── README.md               # Project documentation
```

---

## 🧪 Testing Setup

### 1. **Cypress Configuration**

- **`config/base.config.js`**  
  This file defines the core configuration for Cypress E2E tests. It includes:
  - `baseUrl` and `apiUrl` from environment variables
  - Viewport size for consistent testing (`1980x1080`)
  - Retry settings for failed tests (`2 retries in run mode`)
  - Experimental features (`experimentalOrigin`, `experimentalStudio`)
  - Timeout settings (`defaultCommandTimeout: 10000`)
  - Screenshot and video recording for debugging
  - Cleanup of test artifacts after runs
  - Parallel execution settings (`numTestsPerWorker: 100`)

- **`cypress.config.js`**  
  This is the default configuration file used by Cypress. It is dynamically generated by `cypressRunner.js` based on the environment (`dev`, `staging`, or `prod`). The configuration includes:
  - `baseUrl`: `https://juice-shop.herokuapp.com`
  - `apiUrl`: `https://juice-shop.herokuapp.com/rest`
  - Same settings as `base.config.js` (viewport, retries, etc.)

- **`cypress.env.js`**  
  Defines environment-specific variables for `dev`, `staging`, and `prod`. All environments currently point to the same Juice Shop Heroku instance (`https://juice-shop.herokuapp.com`).

---

### 2. **Dynamic Configuration with `cypressRunner.js`**

The `cypressRunner.js` script is the heart of the project's flexibility. It:
- Parses command-line arguments (e.g., `--env dev`, `--open`, `--headless`)
- Loads environment variables from `cypress.env.js`
- Generates the `cypress.config.js` file dynamically using `config/base.config.js`
- Runs or opens Cypress based on flags

**Example Usage:**
```bash
# Run tests in dev environment with headless mode
npm run cypress:dev -- --headless

# Run tests in staging environment in parallel
npm run cypress:staging -- --parallel

# Launch Cypress GUI for interactive testing
npm run cypress:open
```

---

## 🧪 Test Execution

### 1. **Test Files**

- **`cypress/e2e/test.cy.js`**  
  A placeholder test file that checks `1 === 1`. This is a simple example; actual tests would be in similar files under the `e2e/` directory.

### 2. **Support Files**

- **`cypress/support/e2e.js`**  
  Imports custom commands from `commands.js`, which is where reusable Cypress commands (e.g., `cy.login()`, `cy.createUser()`) would be defined.

---

## 🔄 CI/CD Integration

### 1. **GitHub Actions Workflow**

- **`.github/workflows/cypress.yml`**  
  This workflow runs Cypress tests on every `push` event to the repository. Key features:
  - Uses **parallel execution** with a matrix strategy (`containers: [1, 2]`)
  - Runs on **Ubuntu** with the latest version
  - Uses the official [Cypress GitHub Action](https://github.com/cypress-io/github-action)
  - Starts the app server with `npm start` and waits for `http://localhost:3000`
  - Records test results to **Cypress Cloud** (requires `CYPRESS_RECORD_KEY` secret)

---

## 🛠️ Development Setup

### 1. **Dependencies**

- **Cypress**: `^14.5.3`
- **ESLint**: `^9.32.0` (for linting)
- **Prettier**: `^3.6.2` (for code formatting)

### 2. **Scripts**

| Script                  | Description |
|------------------------|-------------|
| `npm run lint`         | Lints JavaScript and Cypress files |
| `npm run format`       | Formats code with Prettier |
| `npm run cypress:dev`  | Runs tests in the **dev** environment |
| `npm run cypress:staging` | Runs tests in the **staging** environment |
| `npm run cypress:prod` | Runs tests in the **prod** environment |
| `npm run cypress:open` | Launches the **Cypress GUI** for interactive testing |

---

## 📌 Key Features

- **Environment Flexibility**: Supports `dev`, `staging`, and `prod` environments with dynamic configuration.
- **Parallel Execution**: Tests run in parallel using GitHub Actions and Cypress's built-in parallelization.
- **CI/CD Integration**: Fully automated testing via GitHub Actions.
- **Customizable Configuration**: Uses `base.config.js` and `cypress.env.js` for centralized settings.
- **Test Artifacts**: Screenshots, videos, and logs are automatically generated and cleaned up.

---

## 📌 Notes

- The project currently uses the same Juice Shop instance (`https://juice-shop.herokuapp.com`) for all environments. This may be replaced with environment-specific URLs in production.
- The `cypressRunner.js` script is essential for dynamically generating the `cypress.config.js` file based on the environment.
- The GitHub Actions workflow requires the `CYPRESS_RECORD_KEY` secret to be set in the repository's **Settings → Secrets → Actions**.

---

## 📚 Further Reading

- [Cypress Documentation](https://docs.cypress.io/)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Cypress GitHub Action](https://github.com/cypress-io/github-action)

This project provides a scalable and maintainable setup for E2E testing, making it ideal for applications requiring robust test automation and CI/CD integration.